<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.gotak.address.plugin"
    android:versionCode="1768427961"
    android:versionName="1.1.0 (b261ea8e) - [5.2.0]" >

    <uses-sdk
        android:minSdkVersion="21"
        android:targetSdkVersion="34" />

    <!-- Query ATAK packages for URI navigation (Android 11+) -->
    <queries>
        <package android:name="com.atakmap.app.civ" />
        <package android:name="com.atakmap.app" />
        <package android:name="com.atakmap.app.mil" />
        <package android:name="com.atakmap.app.gov" />
    </queries>

    <!-- USB Host feature for RIDAR device communication -->
    <uses-feature
        android:name="android.hardware.usb.host"
        android:required="false" />

    <!-- Bluetooth permissions for wireless RIDAR connection and EUD BLE scanning -->
    <uses-feature
        android:name="android.hardware.bluetooth"
        android:required="false" />
    <uses-feature
        android:name="android.hardware.bluetooth_le"
        android:required="false" />

    <uses-permission
        android:name="android.permission.BLUETOOTH"
        android:maxSdkVersion="30" />
    <uses-permission
        android:name="android.permission.BLUETOOTH_ADMIN"
        android:maxSdkVersion="30" />
    <!-- Android 12+ Bluetooth permissions - need location for Remote ID drone detection -->
    <uses-permission android:name="android.permission.BLUETOOTH_CONNECT" />
    <uses-permission android:name="android.permission.BLUETOOTH_SCAN" />

    <!-- WiFi permissions for EUD Remote ID WiFi Beacon scanning -->
    <uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
    <uses-permission android:name="android.permission.CHANGE_WIFI_STATE" />
    <!-- Android 13+ WiFi Nearby permission - need location for Remote ID scanning -->
    <uses-permission android:name="android.permission.NEARBY_WIFI_DEVICES" />

    <!-- WiFi Aware (NaN) for EUD Remote ID scanning - optional feature -->
    <uses-feature
        android:name="android.hardware.wifi.aware"
        android:required="false" />

    <!-- Location permissions required for Remote ID drone detection -->
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />

    <!-- Internet permission for Nominatim geocoding API -->
    <uses-permission android:name="android.permission.INTERNET" />

    <!-- Storage permissions for importing offline address databases -->
    <uses-permission
        android:name="android.permission.READ_EXTERNAL_STORAGE"
        android:maxSdkVersion="32" />
    <uses-permission
        android:name="android.permission.WRITE_EXTERNAL_STORAGE"
        android:maxSdkVersion="29" />

    <application
        android:allowBackup="false"
        android:appComponentFactory="androidx.core.app.CoreComponentFactory"
        android:debuggable="true"
        android:description="@string/app_desc"
        android:extractNativeLibs="true"
        android:icon="@drawable/ic_launcher"
        android:label="@string/app_name"
        android:theme="@style/AppTheme" >
        <meta-data
            android:name="plugin-api"
            android:value="com.atakmap.app@5.2.0.CIV" />
        <meta-data
            android:name="app_desc"
            android:value="@string/app_desc" />

        <!--
            This fictitious activity entry allow for ATAK 4.6.0.2 and newer to perform 
            plugin discovery  android devices.  If this is removed, the plugin will 
            not be able to be discovered or loaded.
        -->
        <activity
            android:name="com.atakmap.app.component"
            android:exported="true"
            android:icon="@drawable/ic_launcher" >
            <intent-filter
                android:icon="@drawable/ic_launcher"
                android:label="@string/app_name" >
                <action android:name="com.atakmap.app.component" />
            </intent-filter>
        </activity>

        <!--
            Permission request activity for Android 13+ 
            Must be exported=true since ATAK (different UID) launches this activity
        -->
        <activity
            android:name="com.gotak.address.PluginPermissionActivity"
            android:exported="true"
            android:theme="@android:style/Theme.Translucent.NoTitleBar" />

        <!--
            View Navigation Activity - handles addressview:// URI scheme
            Allows external apps, browsers, QR codes to navigate ATAK to specific positions
            Example: addressview://navigate?lat=40.7128&lon=-74.006&zoom=15&tilt=45&rotation=90
        -->
        <activity
            android:name="com.gotak.address.ViewNavigationActivity"
            android:exported="true"
            android:launchMode="singleTask"
            android:theme="@android:style/Theme.Translucent.NoTitleBar" >
            <intent-filter>
                <action android:name="android.intent.action.VIEW" />

                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />

                <data android:scheme="addressview" />
            </intent-filter>
        </activity>
    </application>

</manifest>